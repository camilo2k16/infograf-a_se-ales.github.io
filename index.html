<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Datos de Motores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    
    <!-- Tu aplicación -->
    <script type="text/babel">
        const { useState } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        function MotorDataVisualizer() {
          const [data, setData] = useState(null);
          const [error, setError] = useState(null);

          const parseTextFile = (content) => {
            const lines = content.trim().split('\n');
            const parsedData = [];
            let currentEntry = {};

            for (let line of lines) {
              line = line.trim();
              if (line.startsWith('V:')) {
                currentEntry.V = parseFloat(line.split(':')[1].trim());
              } else if (line.startsWith('W:')) {
                currentEntry.W = parseFloat(line.split(':')[1].trim());
              } else if (line.startsWith('PWM:')) {
                currentEntry.PWM = parseFloat(line.split(':')[1].trim());
              } else if (line.startsWith('t:')) {
                currentEntry.t = parseFloat(line.split(':')[1].trim());
                parsedData.push({ ...currentEntry });
                currentEntry = {};
              }
            }

            return parsedData.slice(8);
          };

          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const content = e.target.result;
                const parsedData = parseTextFile(content);
                
                if (parsedData.length === 0) {
                  setError('No se encontraron datos válidos en el archivo');
                  setData(null);
                  return;
                }

                const dataWithIndex = parsedData.map((item, idx) => ({
                  ...item,
                  index: idx + 1
                }));

                setData(dataWithIndex);
                setError(null);
              } catch (err) {
                setError('Error al procesar el archivo: ' + err.message);
                setData(null);
              }
            };

            reader.onerror = () => {
              setError('Error al leer el archivo');
              setData(null);
            };

            reader.readAsText(file);
          };

          return React.createElement(
            'div',
            { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8' },
            React.createElement(
              'div',
              { className: 'max-w-7xl mx-auto' },
              React.createElement('h1', { className: 'text-4xl font-bold text-gray-800 mb-8 text-center' }, 'Visualizador de Datos de Motores'),
              
              React.createElement(
                'div',
                { className: 'bg-white rounded-lg shadow-lg p-6 mb-8' },
                React.createElement(
                  'label',
                  { className: 'flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-indigo-300 rounded-lg cursor-pointer hover:bg-indigo-50 transition-colors' },
                  React.createElement(
                    'div',
                    { className: 'flex flex-col items-center justify-center pt-5 pb-6' },
                    React.createElement(
                      'svg',
                      { className: 'w-10 h-10 text-indigo-500 mb-2', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                      React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12' })
                    ),
                    React.createElement('p', { className: 'text-sm text-gray-600' }, 
                      React.createElement('span', { className: 'font-semibold' }, 'Click para subir'),
                      ' o arrastra el archivo .txt'
                    )
                  ),
                  React.createElement('input', { type: 'file', className: 'hidden', accept: '.txt', onChange: handleFileUpload })
                )
              ),

              error && React.createElement(
                'div',
                { className: 'bg-red-50 border border-red-200 rounded-lg p-4 mb-8 flex items-start' },
                React.createElement(
                  'svg',
                  { className: 'w-5 h-5 text-red-500 mr-2 mt-0.5', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                  React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' })
                ),
                React.createElement('p', { className: 'text-red-700' }, error)
              ),

              data && React.createElement(
                'div',
                { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
                
                // Gráfica 1: Velocidad
                React.createElement(
                  'div',
                  { className: 'bg-white rounded-lg shadow-lg p-6' },
                  React.createElement('h2', { className: 'text-xl font-semibold text-gray-800 mb-4' }, 'Velocidad de la Pieza (V)'),
                  React.createElement(
                    ResponsiveContainer,
                    { width: '100%', height: 300 },
                    React.createElement(
                      LineChart,
                      { data: data },
                      React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
                      React.createElement(XAxis, { dataKey: 'index', label: { value: 'Muestra', position: 'insideBottom', offset: -5 } }),
                      React.createElement(YAxis, { label: { value: 'Velocidad (V)', angle: -90, position: 'insideLeft' } }),
                      React.createElement(Tooltip, null),
                      React.createElement(Legend, null),
                      React.createElement(Line, { type: 'monotone', dataKey: 'V', stroke: '#8b5cf6', strokeWidth: 2, dot: { r: 3 }, name: 'Velocidad' })
                    )
                  )
                ),

                // Gráfica 2: Velocidad Angular
                React.createElement(
                  'div',
                  { className: 'bg-white rounded-lg shadow-lg p-6' },
                  React.createElement('h2', { className: 'text-xl font-semibold text-gray-800 mb-4' }, 'Velocidad Angular de los Motores (W)'),
                  React.createElement(
                    ResponsiveContainer,
                    { width: '100%', height: 300 },
                    React.createElement(
                      LineChart,
                      { data: data },
                      React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
                      React.createElement(XAxis, { dataKey: 'index', label: { value: 'Muestra', position: 'insideBottom', offset: -5 } }),
                      React.createElement(YAxis, { label: { value: 'Velocidad Angular (W)', angle: -90, position: 'insideLeft' } }),
                      React.createElement(Tooltip, null),
                      React.createElement(Legend, null),
                      React.createElement(Line, { type: 'monotone', dataKey: 'W', stroke: '#10b981', strokeWidth: 2, dot: { r: 3 }, name: 'Velocidad Angular' })
                    )
                  )
                ),

                // Gráfica 3: PWM
                React.createElement(
                  'div',
                  { className: 'bg-white rounded-lg shadow-lg p-6' },
                  React.createElement('h2', { className: 'text-xl font-semibold text-gray-800 mb-4' }, 'PWM'),
                  React.createElement(
                    ResponsiveContainer,
                    { width: '100%', height: 300 },
                    React.createElement(
                      LineChart,
                      { data: data },
                      React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
                      React.createElement(XAxis, { dataKey: 'index', label: { value: 'Muestra', position: 'insideBottom', offset: -5 } }),
                      React.createElement(YAxis, { label: { value: 'PWM', angle: -90, position: 'insideLeft' } }),
                      React.createElement(Tooltip, null),
                      React.createElement(Legend, null),
                      React.createElement(Line, { type: 'monotone', dataKey: 'PWM', stroke: '#f59e0b', strokeWidth: 2, dot: { r: 3 }, name: 'PWM' })
                    )
                  )
                ),

                // Gráfica 4: Tiempo vs PWM
                React.createElement(
                  'div',
                  { className: 'bg-white rounded-lg shadow-lg p-6' },
                  React.createElement('h2', { className: 'text-xl font-semibold text-gray-800 mb-4' }, 'Tiempo vs PWM'),
                  React.createElement(
                    ResponsiveContainer,
                    { width: '100%', height: 300 },
                    React.createElement(
                      LineChart,
                      { data: data },
                      React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
                      React.createElement(XAxis, { dataKey: 't', label: { value: 'Tiempo (t)', position: 'insideBottom', offset: -5 } }),
                      React.createElement(YAxis, { label: { value: 'PWM', angle: -90, position: 'insideLeft' } }),
                      React.createElement(Tooltip, null),
                      React.createElement(Legend, null),
                      React.createElement(Line, { type: 'monotone', dataKey: 'PWM', stroke: '#ef4444', strokeWidth: 2, dot: { r: 3 }, name: 'PWM' })
                    )
                  )
                )
              ),

              !data && !error && React.createElement(
                'div',
                { className: 'bg-blue-50 border border-blue-200 rounded-lg p-6 text-center' },
                React.createElement('p', { className: 'text-gray-600' }, 'Sube un archivo .txt para visualizar los datos. Los primeros 8 registros serán eliminados automáticamente.')
              )
            )
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(MotorDataVisualizer));
    </script>
</body>
</html>

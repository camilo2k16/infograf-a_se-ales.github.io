<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Datos de Motores</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: white;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        .upload-box {
            background: white;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            border: 3px dashed #667eea;
            cursor: pointer;
        }
        .upload-box:hover {
            background: #f0f0f0;
        }
        .upload-box input {
            display: none;
        }
        .error-box {
            background: #ffe0e0;
            border: 2px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #c92a2a;
            display: none;
        }
        .info-box {
            background: #e3f2fd;
            border: 2px solid #64b5f6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #1976d2;
        }
        .charts {
            display: none;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }
        .chart-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        canvas {
            width: 100% !important;
            height: 300px !important;
        }
        @media (max-width: 768px) {
            .charts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Visualizador de Datos de Motores</h1>
        <div class="upload-box" id="uploadBox">
            <h2>üìÅ Click para subir archivo .txt</h2>
            <p>O arrastra el archivo aqu√≠</p>
            <input type="file" id="fileInput" accept=".txt">
        </div>
        <div class="error-box" id="errorBox"></div>
        <div class="info-box" id="infoBox">
            Sube un archivo .txt para visualizar los datos. Los primeros 8 registros ser√°n eliminados autom√°ticamente.
        </div>
        <div class="charts" id="charts">
            <div class="chart-box">
                <div class="chart-title">Velocidad de la Pieza (V)</div>
                <canvas id="chart1"></canvas>
            </div>
            <div class="chart-box">
                <div class="chart-title">Velocidad Angular de los Motores (W)</div>
                <canvas id="chart2"></canvas>
            </div>
            <div class="chart-box">
                <div class="chart-title">PWM</div>
                <canvas id="chart3"></canvas>
            </div>
            <div class="chart-box">
                <div class="chart-title">Tiempo vs PWM</div>
                <canvas id="chart4"></canvas>
            </div>
        </div>
    </div>
    <script>
        let myCharts = [];
        document.getElementById('uploadBox').onclick = function() {
            document.getElementById('fileInput').click();
        };
        document.getElementById('fileInput').onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const texto = event.target.result;
                    const datos = procesarArchivo(texto);
                    if (datos.length === 0) {
                        mostrarError('No se encontraron datos v√°lidos');
                        return;
                    }
                    crearGraficas(datos);
                } catch (error) {
                    mostrarError('Error: ' + error.message);
                }
            };
            reader.readAsText(file);
        };
        const uploadBox = document.getElementById('uploadBox');
        uploadBox.ondragover = function(e) {
            e.preventDefault();
            this.style.background = '#f0f0f0';
        };
        uploadBox.ondragleave = function(e) {
            e.preventDefault();
            this.style.background = 'white';
        };
        uploadBox.ondrop = function(e) {
            e.preventDefault();
            this.style.background = 'white';
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.txt')) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                document.getElementById('fileInput').dispatchEvent(new Event('change'));
            }
        };
        function procesarArchivo(texto) {
            const lineas = texto.trim().split('\n');
            const datos = [];
            let entrada = {};
            for (let linea of lineas) {
                linea = linea.trim();
                if (!linea) continue;
                if (linea.startsWith('V:')) {
                    entrada.V = parseFloat(linea.split(':')[1]);
                } else if (linea.startsWith('W:')) {
                    entrada.W = parseFloat(linea.split(':')[1]);
                } else if (linea.startsWith('PWM:')) {
                    entrada.PWM = parseFloat(linea.split(':')[1]);
                } else if (linea.startsWith('t:')) {
                    entrada.t = parseFloat(linea.split(':')[1]);
                    if (entrada.V !== undefined && entrada.W !== undefined && entrada.PWM !== undefined) {
                        datos.push({...entrada});
                    }
                    entrada = {};
                }
            }
            return datos.slice(8);
        }
        function mostrarError(mensaje) {
            document.getElementById('errorBox').textContent = mensaje;
            document.getElementById('errorBox').style.display = 'block';
            document.getElementById('infoBox').style.display = 'none';
            document.getElementById('charts').style.display = 'none';
        }
        function crearGraficas(datos) {
            document.getElementById('errorBox').style.display = 'none';
            document.getElementById('infoBox').style.display = 'none';
            document.getElementById('charts').style.display = 'grid';
            myCharts.forEach(chart => chart.destroy());
            myCharts = [];
            const indices = datos.map((_, i) => i + 1);
            const velocidades = datos.map(d => d.V);
            const velocidadesAngulares = datos.map(d => d.W);
            const pwmValues = datos.map(d => d.PWM);
            const tiempos = datos.map(d => d.t);
            const ctx1 = document.getElementById('chart1').getContext('2d');
            myCharts.push(new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: indices,
                    datasets: [{
                        label: 'Velocidad (V)',
                        data: velocidades,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        pointRadius: 3,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true } },
                    scales: {
                        x: { title: { display: true, text: 'Muestra' } },
                        y: { title: { display: true, text: 'Velocidad (V)' } }
                    }
                }
            }));
            const ctx2 = document.getElementById('chart2').getContext('2d');
            myCharts.push(new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: indices,
                    datasets: [{
                        label: 'Velocidad Angular (W)',
                        data: velocidadesAngulares,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        pointRadius: 3,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true } },
                    scales: {
                        x: { title: { display: true, text: 'Muestra' } },
                        y: { title: { display: true, text: 'Velocidad Angular (W)' } }
                    }
                }
            }));
            const ctx3 = document.getElementById('chart3').getContext('2d');
            myCharts.push(new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: indices,
                    datasets: [{
                        label: 'PWM',
                        data: pwmValues,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 2,
                        pointRadius: 3,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true } },
                    scales: {
                        x: { title: { display: true, text: 'Muestra' } },
                        y: { title: { display: true, text: 'PWM' } }
                    }
                }
            }));
            const ctx4 = document.getElementById('chart4').getContext('2d');
            myCharts.push(new Chart(ctx4, {
                type: 'line',
                data: {
                    labels: tiempos,
                    datasets: [{
                        label: 'PWM',
                        data: pwmValues,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        pointRadius: 3,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true } },
                    scales: {
                        x: { 
                            title: { display: true, text: 'Tiempo (t)' },
                            type: 'linear'
                        },
                        y: { title: { display: true, text: 'PWM' } }
                    }
                }
            }));
        }
    </script>
</body>
</html>
